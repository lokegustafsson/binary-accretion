\documentclass[../main.tex]{subfiles}

\begin{document}
\subsection{Introduction}
Smoothed-particle hydrodynamics (SPH) is a method in computational fluid dynamics used to numerically solve a system of differential equations. Insert history.

SPH is a particle-based, Lagrangian method. This confers several advantages over mesh-based, Eulerian methods in astrophysical problems such as those studied in this paper:
\begin{enumerate}
    \item The lack of boundary conditions.
    \item Large regions of low density
    \item Adaptive resolutions
\end{enumerate}

\subsection{Fundamentals}
For a given vector or scalar field $A$ we define the integral interpolant $A_I \approx A$ as

\begin{equation}
    A_I(\bm{r}) = \int A(\bm{r}) W(\bm{r} - \bm{r'}, h) d\bm{r'}
\end{equation}

where $\bm{r}$ and $\bm{r'}$ are position vectors with units $m$ and $h$ is a scalar ``smoothing length'' with units $m$. The (scalar) kernel function $W(\bm{r}, h)$ has units $m^{-3}$ and satisfies

\begin{equation}
    \int W(\bm{r}, h) d\bm{r} = 1
\end{equation}

and

\begin{equation}
    \lim_{h\to0} W(\bm{r}, h) d\bm{r} = \delta(x) = \begin{cases}
        +\infty & \text{for } x = 0 \\
        0 & \text{otherwise} \end{cases}
\end{equation}

The field $A_I$ is a smoothed version of $A$, with a granularity dependent on $h$. The core idea in SPH is to approximate the integral interpolant with a finite sum over the particles, and so we define the summation interpolant $A_S \approx A_I$ as

\begin{equation}
    A_S(\bm{r}) = \sum_{b} V_b A(b) W(\bm{r} - \bm{r_b}, h)
\end{equation}

where the sum is over all the SPH particles. The particles each have a position $\bm{r}$, velocity $\bm{v}$, mass $m$ and thermal energy $u$. All other fields have to be computed and interpolated from these, the most fundamental of which is the density.

The density field is particularly important due to the particles having known masses, and the summation interpolant using the volumes of the particles. Writing the volume $V_b$ as $\dfrac{m_b}{\rho(\bm{r_b})}$ allows us to talk about the density rather than the volume:

\begin{equation} \label{eq:2.5}
    A_S(\bm{r}) = \sum_{b} \frac{m_b}{\rho(\bm{r_b})} A(\bm{r_b}) W(\bm{r} - \bm{r_b}, h)
\end{equation}

which also gives us the density interpolant

\begin{equation}
    \rho_S(\bm{r}) = \sum_{b} \frac{m_b}{\rho(\bm{r_b})} \rho(\bm{r_b}) W(\bm{r} - \bm{r_b}, h) = \sum_{b} m_b W(\bm{r} - \bm{r_b}, h)
\end{equation}

At this point we drop the $I$ and $S$ subscripts for the interpolants since this would be unnecessarily verbose and intent will be clear from context. This allows us to shorten $A_S(\bm{r_b})$ to $A_b$. We will also write $W(\bm{r_a} - \bm{r_b}, h)$ as $W_{ab}$ and let $\nabla_a$ denote the gradient with respect to the space coordinates of particle $a$.

\subsection{Operators}
In order to solve the differential equations we need a way to compute gradients, divergence and curls within the SPH framework. More specifically, we need a way to compute $\nabla A$, $\nabla\cdot\bm{F}$ and $\nabla\times\bm{F}$, where $A$ and $\bm{F}$ are arbitrary scalar and vector fields respectively.

Using (\ref{eq:2.5}) we can write $(\nabla A)_a$ as

\begin{equation}
    (\nabla A)_a = (\nabla_a A)_a =
    \sum_b \frac{m_b}{\rho_b} A_b \nabla_a W_{ab} =
    \sum_b \frac{m_b A_b \nabla_a W_{ab}}{\sum_c m_c W_{bc}}
\end{equation}

giving us the gradient of any field for which we can compute $A_b$.

However, it turns out \autocite{monaghan1992} that this nested sum decreases precision. Instead, the usual approach is to calulate the interpolated $(\nabla(\rho A))_a$ and then retrieve $A$ through $\rho\nabla A = \nabla(\rho A) - \nabla\rho A$.

$\rho A$ is a field like any other, but the fact that the density cancels in its interpolant makes the computation simpler:

\begin{equation}
    \nabla_a (\rho A) = \nabla_a \sum_b \frac{m_b}{\rho_b} \rho_b A_b W_{ab} = \sum_b m_b A_b \nabla_a W_{ab}
\end{equation}

$\nabla A$ is then computed as

\begin{equation}
    \rho_a (\nabla A)_a = \nabla_a (\rho A) - (\nabla\rho)_a A_a = \sum_b m_b (A_b - A_a) \nabla_a W_{ab}
\end{equation}

Similarly using the product rules of the divergence and curl and simplifying gives us the two other operators:

\begin{equation}
    \rho_a (\nabla\cdot\bm{F})_a = \sum_b m_b (\bm{F}_b - \bm{F}_a) \cdot \nabla_a W_{ab}
\end{equation}

\begin{equation}
    \rho_a (\nabla\times\bm{F})_a = - \sum_b m_b (\bm{F}_b - \bm{F}_a) \times \nabla_a W_{ab}
\end{equation}

However, this is not the entire story as SPH allows most fields to be interpolated in different ways. In particular, RETURN WHEN I ACTUALLY UNDERSTAND THE SYMMETRIC PRESSURE INTERPOLANT

ACTUALLY I AM STUPID AND THIS IS TRIVIAL: $(P_b - P_a)(\bm{r}_a - \bm{r}_b)$ is not symmetric!


\subsection{Governing equations}

This work uses the Euler equation for momentum balance of a compressible inviscid fluid:

\begin{equation}
    \frac{d\bm{v_a}}{dt} = - \frac{1}{\rho_a} (\nabla P)_a + \bm{g}_a
\end{equation}

A mass balance equation is not necessary as the density is interpolated from the particle masses in each iteration.

The only external force considered is gravity, as magnetism, radiative transfer and special relativity are all ignored in this work: (The gravitational field is the negative gradient of the gravitational potential field)

\begin{equation}
    \bm{g}_a = -\nabla_a\int\frac{-G\rho(\bm{r'})}{|\bm{r_a} - \bm{r'}|} d\bm{r'} = \int\frac{G\rho(\bm{r'})(\bm{r_a}-\bm{r'})}{|\bm{r_a}-\bm{r'}|^3} d\bm{r'}
\end{equation}

This integral can be computed by summing over all the particles. Note that this is not an interpolation integral, and computing it naively for all the particles would take quadratic time regardless of the kernel function. For this reason, we use a more sophisticated tree structure to compute the gravitational acceleration.

Calculating the gradient of the pressure requires us to compute the pressure at the particles using the ideal gas law.

\begin{equation}
    \frac{2E}{3} = nRT = PV = \frac{Pm}{\rho}
\end{equation}

Giving us the pressure at a particle

\begin{equation}
    P_a = \frac{2 E_a}{3 m_a} \rho_a = \tau_a \rho_a
\end{equation}

The pressure factor $\tau_a = \frac{2E_a}{3m_a}$ is constant in this paper's
isothermal simulation.

\end{document}
