\documentclass[../main.tex]{subfiles}

\begin{document}
\subsection{Introduction}
Smoothed-particle hydrodynamics (SPH) is a method in computational fluid dynamics used to
numerically solve a system of differential equations. Insert history.

SPH is a particle-based, Lagrangian method. This confers several advantages over mesh-based,
Eulerian methods in astrophysical problems such as those studied in this paper:
\begin{enumerate}
    \item The lack of boundary conditions.
    \item Large regions of low density
    \item Adaptive resolutions
\end{enumerate}

\subsection{Fundamentals}
For a given vector or scalar field $A$ we define the integral interpolant $A_I \approx A$ as

\begin{equation}
    A_I(\bm{r})
    = \int A(\bm{r}) W(||\bm{r} - \bm{r'}||, h) d\bm{r'}
\end{equation}

where $\bm{r}$ and $\bm{r'}$ are position vectors with units $m$ and $h$ is a scalar ``smoothing
length'' with units $m$. The (scalar) kernel function $W(\bm{r}, h)$ has units $m^{-3}$ and
satisfies

\begin{equation}
    \int W(||\bm{r}||, h) d\bm{r} = 1
\end{equation}

where the integral is over all space and

\begin{equation}
    \lim_{h\to0} W(||\bm{r}||, h) d\bm{r}
    = \delta(x)
    = \begin{cases}
        +\infty & \text{for } x = 0 \\
        0 & \text{otherwise} \end{cases}
\end{equation}

The field $A_I$ is a smoothed version of $A$, with a granularity dependent on $h$. The core idea of
SPH is to approximate the integral interpolant with a finite sum over the particles, and so we
define the summation interpolant $A_S \approx A_I$ as

\begin{equation}
    A_S(\bm{r})
    = \sum_{b} V_b A(b) W(||\bm{r} - \bm{r_b}||, h)
\end{equation}

where the sum is over all the SPH particles. The particles each have a position $\bm{r}$, velocity
$\bm{v}$, mass $m$ and thermal energy $E$. All other fields can be computed and interpolated
from these, the most fundamental of which is density.

The density field is particularly important due to the particles having known masses, and the
summation interpolant using the volumes of the particles. Writing the volume $V_b$ as
$\dfrac{m_b}{\rho(\bm{r_b})}$ allows us to talk about the density rather than the volume:

\begin{equation} \label{eq:2.5}
    A_S(\bm{r})
    = \sum_{b} \frac{m_b}{\rho(\bm{r_b})} A(\bm{r_b}) W(\bm{r} - \bm{r_b}, h)
\end{equation}

which also gives us the density interpolant

\begin{equation}
    \rho_S(\bm{r})
    = \sum_{b} \frac{m_b}{\rho(\bm{r_b})} \rho(\bm{r_b}) W(\bm{r} - \bm{r_b}, h)
    = \sum_{b} m_b W(\bm{r} - \bm{r_b}, h)
\end{equation}

At this point we drop the $I$ and $S$ subscripts for the interpolants as this would be
unnecessarily verbose and intent will be clear from context. This allows us to shorten
$A_S(\bm{r_b})$ to $A_b$. We will also write $W(\bm{r_a} - \bm{r_b}, h)$ as $W_{ab}$ and let
$\nabla_a$ denote the gradient with respect to the space coordinates of particle $a$.

\subsection{Operators}
In order to solve the differential equations we need a way to compute gradients, divergence and
curls within the SPH framework. More specifically, we need a way to compute
$\nabla A$, $\nabla\cdot\bm{F}$ and $\nabla\times\bm{F}$, where $A$ and $\bm{F}$ are arbitrary
scalar and vector fields respectively.

Using (\ref{eq:2.5}) we can write $(\nabla A)_a$ as

\begin{equation} \label{eq:2.7}
    (\nabla A)_a
    = (\nabla_a A)_a
    = \sum_b \frac{m_b}{\rho_b} A_b \nabla_a W_{ab}
    = \sum_b \frac{m_b A_b \nabla_a W_{ab}}{\sum_c m_c W_{bc}}
\end{equation}

giving us the gradient of any field for which we can compute $A_b$.

However, it turns out \autocite{monaghan1992} that this nested sum decreases precision. Instead, the
usual approach is to calulate the interpolated $(\nabla(\rho A))_a$ and then retrieve $A$ through
$\rho\nabla A = \nabla(\rho A) - \nabla\rho A$.

$\rho A$ is a field like any other, and the fact that the density cancels in its interpolant makes
the computation simpler:

\begin{equation}
    \nabla_a (\rho A)
    = \nabla_a \sum_b \frac{m_b}{\rho_b} \rho_b A_b W_{ab}
    = \sum_b m_b A_b \nabla_a W_{ab}
\end{equation}

$\nabla A$ is then computed as

\begin{equation} \label{eq:2.9}
    \rho_a (\nabla A)_a
    = \nabla_a (\rho A) - (\nabla\rho)_a A_a
    = \sum_b m_b (A_b - A_a) \nabla_a W_{ab}
\end{equation}

Similarly using the product rules of the divergence and curl and simplifying gives us the two other
operators:

\begin{equation}
    \rho_a (\nabla\cdot\bm{F})_a
    = \sum_b m_b (\bm{F}_b - \bm{F}_a) \cdot \nabla_a W_{ab}
\end{equation}

\begin{equation}
    \rho_a (\nabla\times\bm{F})_a
    = - \sum_b m_b (\bm{F}_b - \bm{F}_a) \times \nabla_a W_{ab}
\end{equation}

However, this is not the entire story as SPH allows most fields to be interpolated in different
ways: recall that we have already expressed $\nabla A$ in two different ways with (\ref{eq:2.5}) and
(\ref{eq:2.9}).

It is quite desireable for our equations to conserve momentum, and so, since momentum transfer in
fluids is driven by pressure gradients, an ideal pressure interpolant sums up terms that exactly and
only changes sign when $a$ and $b$ are flipped. Note that (\ref{eq:2.9}) does not fullfill this
criteria:

\begin{equation}
\begin{split}
    (A_b - A_a) \nabla_a W_{ab} = (A_b - A_a) (-2(r_a - r_b) \cdot W_{ab}) \\
  = (A_a - A_b) \nabla_b W_{ba} = (A_a - A_b) (-2(r_b - r_a) \cdot W_{ba})
\end{split}
\end{equation}

Which holds since the kernel is a function of only the absolute distance and the smoothing length:
i.e. $W_{ab} = W(||r_a - r_b||, h_{ab}) = W(||r_b - r_a||, h_{ba}) = W_{ba}$ and we pick a symmetric
smoothing length.

Monaghan \autocite{monaghan1992} suggests writing

\begin{equation}
    \frac{\nabla P}{\rho} = \nabla (\frac{P}{\rho}) + \frac{P}{\rho^2} \nabla \rho
\end{equation}

giving

\begin{equation}
    (\nabla P)_a = \rho_a \sum_b m_b (\frac{P_a}{\rho_b^2} + \frac{P_b}{\rho_a^2}) \nabla_a W_{ab}
\end{equation}

This is the equation used in this work.

WHAT SENSE CAN I MAKE OF MONAGHAN'S THERMAL ENERGY EQUATION?

\end{document}
